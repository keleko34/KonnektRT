var KonnektRT=function(){var m=function(){var l=require("fs"),m=require("querystring"),B=process.cwd().replace(/\\/g,"/")+"/app";require("path");var C=require("replacestream"),D=require("stream"),E=require("util");return function(){function p(a,d,b){if(0===a.url.indexOf("/component")){a.query||(a.query={});a.stringQuery=p.parseQuery(a.url);a.url=a.url.substring(0,a.url.indexOf("?"));b=0;for(var f=Object.keys(a.stringQuery),e=f.length;b<e;b++)a.query[f[b]]=a.stringQuery[f[b]];var c=a.url.replace("/component/",
""),q=a.query.env||"prod";b=a.query.debug;var z=a.query.edit,m=a.sessions?a.sessions.cms:!1,u=B+"/components/"+c,x=u+("dev"!==q?"/build/"+q+"/"+c+(b?".js":".min.js"):"/"+c+".js"),g,h=0,k=0;l.stat(x,function(a,b){if(!a&&b.isFile())if("dev"===q){var f=function(a,b,f,e){!a&&f&&b?e?(e=e.replace(/(\r\n)/g,"\r\n\t"),g.pipe(r(c,"k_cms")).pipe(t(g,c,"k_cms","(function(){\r\n\t"+e+"\r\n\treturn "+c+";\r\n}())")).pipe(r(c,"k_html")).pipe(t(g,c,"k_html",b,!0,!0)).pipe(r(c,"k_css")).pipe(t(g,c,"k_css",f,!0,!0)).pipe(d)):
g.pipe(r(c,"k_html")).pipe(t(g,c,"k_html",b,!0,!0)).pipe(r(c,"k_css")).pipe(t(g,c,"k_css",f,!0,!0)).pipe(d):g.pipe(d)};k+=2;g=l.createReadStream(x);var e="",w="",n,v=!1;z&&m&&(k+=1,A(u,c,function(a){h+=1;n=a;h===k&&f(v,e,w,n)}));l.readFile(u+"/"+c+".html","utf8",function(a,b){h+=1;v=!!a;e=b;h===k&&f(v,e,w,n)});l.readFile(u+"/"+c+".css","utf8",function(a,b){h+=1;v=!!a;w=b;h===k&&f(v,e,w,n)})}else{var p=function(a){a?(a=a.replace(/(\r\n)/g,"\r\n\t"),g.pipe(r(c,"k_cms")).pipe(t(g,c,"k_cms","(function(){\r\n\t"+
a+"\r\n\treturn "+c+";\r\n}())")).pipe(d)):g.pipe(d)};g=l.createReadStream(x);z&&m&&(k+=1,A(u,c,function(a){h+=1;n=a;h===k&&p(n)}));0===k&&p(n)}else a&&"ENOENT"===a.code?"dev"!==q?d.notFound?d.notFound(void 0,"You have not built the component "+c+" into environment "+q):y(d,404,"You have not built the component "+c+" into environment "+q):d.notFound?d.notFound(void 0,"There is no such component by the name "+c):y(d,404,"There is no such component by the name "+c):d.serverError?d.serverError():y(d,
500,"Server error")})}else b()}function y(a,d,b){a.statusCode=d;a.statusMessage=b;a.write(b,"utf8",function(){a.end()})}function A(a,d,b){var f=0;l.readFile(a+"/cms/"+d+".js","utf8",function(e,c){e?b("function "+d+"(){/*There was an error retrieving cms components*/};"):(l.readFile(a+"/cms/"+d+".html","utf8",function(a,e){a?b("function "+d+"(){/*There was an error retrieving cms components*/};"):(c+="\r\n"+d+'.prototype.kcms_html = "'+e.replace(/[\r\n]/g,"")+'";',f+=1,2===f&&b(c))}),l.readFile(a+
"/cms/"+d+".css","utf8",function(a,e){a?b("function "+d+"(){/*There was an error retrieving cms components*/};"):(c+="\r\n"+d+'.prototype.kcms_css = "'+e.replace(/[\r\n]/g,"")+'";',f+=1,2===f&&b(c))}))})}function F(a){function d(a){b.call(this,a)}var b=D.Transform;E.inherits(d,b);d.prototype._transform=function(b,d,c){this.push("function"===typeof a?a(b.toString()):b.toString());c()};return new d(a)}function r(a,d){var b=0,f=!1;return F(function(e){f&&(b+=e.split("{").length-1,b-=e.split("}").length-
1);-1!==e.indexOf(a)&&(f=!0,b+=e.split("{").length-1,b-=e.split("}").length-1);0===b&&f&&(e+="\r\n"+a+".prototype."+d+" = ''");return e})}function t(a,d,b,f,e,c){a=d+".prototype."+b+" = "+(e?"'":"");a=c?a+f.replace(/(\")/g,'/"').replace(/[\r\n]/g,""):a+(e?f.replace(/(\")/g,'/"'):f);return C(d+".prototype."+b+" = ''",a+((e?"'":"")+";"))}p.parseQuery=function(a){return m.parse(a.substring(a.indexOf("?")+1,a.length))};return p}}();"undefined"!==typeof window&&"undefined"!==typeof window.define&&"undefined"!==
typeof window.require?define([],function(){return m}):"undefined"!==typeof module&&(module.exports=m);return m}();
