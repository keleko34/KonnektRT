var KonnektRT=function(){var m=function(){var l=require("fs"),m=require("querystring"),D=process.cwd().replace(/\\/g,"/")+"/app";require("path");var E=require("replacestream"),F=require("stream"),G=require("util");return function(){function p(a,d,b){if(0===a.url.indexOf("/component")){a.query||(a.query={});a.stringQuery=p.parseQuery(a.url);-1!==a.url.indexOf("?")&&(a.url=a.url.substring(0,a.url.indexOf("?")));a.url=a.url.replace(".js","");b=0;for(var e=Object.keys(a.stringQuery),f=e.length;b<f;b++)a.query[e[b]]=
a.stringQuery[e[b]];var c=a.url.replace("/component/","").replace(/[\/]/g,""),q=a.query.env||"prod";b=a.query.debug;var A=a.query.edit,m=a.sessions?a.sessions.cms:!1,u=D+"/components/"+c,y=u+("dev"!==q?"/build/"+q+"/"+c+(b?".js":".min.js"):"/"+c+".js"),g,h=0,k=0;l.stat(y,function(a,b){if(!a&&b.isFile())if("dev"===q){var f=function(a,b,f,e){!a&&f&&b?e?(e=e.replace(/(\r\n)/g,"\r\n\t"),g.pipe(r(c,"k_cms")).pipe(t(g,c,"k_cms","(function(){\r\n\t"+e+"\r\n\treturn "+c+";\r\n}())")).pipe(r(c,"k_html")).pipe(t(g,
c,"k_html",b,!0,!0)).pipe(r(c,"k_css")).pipe(t(g,c,"k_css",f,!0,!0)).pipe(v(c)).pipe(d)):g.pipe(r(c,"k_html")).pipe(t(g,c,"k_html",b,!0,!0)).pipe(r(c,"k_css")).pipe(t(g,c,"k_css",f,!0,!0)).pipe(v(c)).pipe(d):g.pipe(v(c)).pipe(d)};k+=2;g=l.createReadStream(y);var e="",x="",n,w=!1;A&&m&&(k+=1,B(u,c,function(a){h+=1;n=a;h===k&&f(w,e,x,n)}));l.readFile(u+"/"+c+".html","utf8",function(a,b){h+=1;w=!!a;e=b;h===k&&f(w,e,x,n)});l.readFile(u+"/"+c+".css","utf8",function(a,b){h+=1;w=!!a;x=b;h===k&&f(w,e,x,n)})}else{var p=
function(a){a?(a=a.replace(/(\r\n)/g,"\r\n\t"),g.pipe(r(c,"k_cms")).pipe(t(g,c,"k_cms","(function(){\r\n\t"+a+"\r\n\treturn "+c+";\r\n}())")).pipe(v(c)).pipe(d)):g.pipe(v(c)).pipe(d)};g=l.createReadStream(y);A&&m&&(k+=1,B(u,c,function(a){h+=1;n=a;h===k&&p(n)}));0===k&&p(n)}else a&&"ENOENT"===a.code?"dev"!==q?d.notFound?d.notFound(void 0,"You have not built the component "+c+" into environment "+q):z(d,404,"You have not built the component "+c+" into environment "+q):d.notFound?d.notFound(void 0,"There is no such component by the name "+
c):z(d,404,"There is no such component by the name "+c):d.serverError?d.serverError():z(d,500,"Server error")})}else b()}function z(a,d,b){a.statusCode=d;a.statusMessage=b;a.write(b,"utf8",function(){a.end()})}function B(a,d,b){var e=0;l.readFile(a+"/cms/"+d+".js","utf8",function(f,c){f?b("function "+d+"(){/*There was an error retrieving cms components*/};"):(l.readFile(a+"/cms/"+d+".html","utf8",function(a,f){a?b("function "+d+"(){/*There was an error retrieving cms components*/};"):(c+="\r\n"+d+
'.prototype.kcms_html = "'+f.replace(/[\r\n]/g,"")+'";',e+=1,2===e&&b(c))}),l.readFile(a+"/cms/"+d+".css","utf8",function(a,f){a?b("function "+d+"(){/*There was an error retrieving cms components*/};"):(c+="\r\n"+d+'.prototype.kcms_css = "'+f.replace(/[\r\n]/g,"")+'";',e+=1,2===e&&b(c))}))})}function C(a,d){function b(a){e.call(this,a)}var e=F.Transform;G.inherits(b,e);b.prototype._transform=function(b,c,d){this.push("function"===typeof a?a(b.toString()):b.toString());d()};b.prototype._flush=function(a){"function"===
typeof d&&this.push(d());a()};return new b({})}function r(a,d){var b=0,e=!1;return C(function(f){e&&(b+=f.split("{").length-1,b-=f.split("}").length-1);-1!==f.indexOf(a)&&(e=!0,b+=f.split("{").length-1,b-=f.split("}").length-1);0===b&&e&&(f+="\r\n"+a+".prototype."+d+" = ''");return f})}function v(a){var d=!1;return C(function(b){d?b=b.replace(/(\r)/g,"").replace(/(\n)/g,"\r\n\t"):(d=!0,b="K_Components['"+a+"'] = (function(){\r\n\t"+b.replace(/(\r)/g,"").replace(/(\n)/g,"\r\n\t"));return b},function(){return"\r\n\treturn "+
a+";\r\n}());"})}function t(a,d,b,e,f,c){a=d+".prototype."+b+" = "+(f?"'":"");a=c?a+e.replace(/(\")/g,'/"').replace(/[\r\n]/g,""):a+(f?e.replace(/(\")/g,'/"'):e);return E(d+".prototype."+b+" = ''",a+((f?"'":"")+";"))}p.parseQuery=function(a){return m.parse(a.substring(a.indexOf("?")+1,a.length))};return p}}();"undefined"!==typeof window&&"undefined"!==typeof window.define&&"undefined"!==typeof window.require?define([],function(){return m}):"undefined"!==typeof module&&(module.exports=m);return m}();
